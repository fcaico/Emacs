2000-05-30  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.3

	* em-dirs.el (eshell-write-last-dir-ring): don't add eshell/pwd
	to the last dir ring before writing.  Only append it to the
	history file.

2000-05-26  John Wiegley  <johnw@gnu.org>

	* esh-util.el (eshell-read-host-names): don't need alias for
	set-window-redisplay-end-trigger anymore.

	* em-smart.el (eshell-smart-scroll-window): removed call to
	set-window-redisplay-end-trigger.  This was causing an error with
	lazy-lock, of all things.

2000-05-02  John Wiegley  <johnw@gnu.org>

	* esh-cmd.el (eshell-parse-pipeline): removed an incorrect assert
	that would always fire in the case of multi-line input
	(eshell-parse-subcommand-argument): fixed a bug that was causing {
	at the end of a line not to be parsed as a subcommand opener
	(eshell-invokify-arg): made this function a bit more resilient by
	testing its argument for validity first
	(eshell-structure-basic-command): moved the calls of
	`eshell-invokify-arg' to their callers, since `while' needs
	different handling (and at a different level) than `if'

	* esh-io.el (eshell-set-output-handle): don't append an output
	target if output is already headed there.  This can happen with
	redirection inside a loop construct

	* em-basic.el (eshell-echo): made echo -n a bit more aggressive
	about putting out a newline, since it's useful for outputting the
	results of a loop to file, line delimited

2000-05-01  John Wiegley  <johnw@gnu.org>

	* esh-cmd.el (eshell-parse-command): changed a usage of
	eshell-protect to eshell-commands.  This means that every command
	in a sequence can now redirect its output separately, the way
	normal shells work.
	(eshell-invokify-arg): created this function for transforming
	${interpolating subcommand} arguments into plain {subcommand}
	arguments, for the sake of the structure commands (for, if, while,
	etc.)
	(eshell-rewrite-for-command): simplified the code by calling
	`eshell-invokify-arg'
	(eshell-structure-basic-command): completely rewrote this
	function.  It is now vastly simpler than it was before.
	(eshell-rewrite-while-command): changed the call parameters to
	`eshell-structure-basic-command'
	(eshell-rewrite-if-command): changed the call parameters to
	`eshell-structure-basic-command'
	(eshell-parse-pipeline): changed the call parameters to
	`eshell-structure-basic-command', which results in a large
	simplification of && and || handling as well
	(eshell-commands): added an extra parameters `silent', which gives
	code rewriting routines the option of creating silent evaluation
	arguments, such as `if' uses (although, within the evaluation the
	output can still be redirected, with no change to the logic)
	(eshell-subcommand-arg-values): removed a use of `eshell-protect'
	that was unnecessary
	(eshell-protect): removed a now unnecessary call to
	`eshell-close-handles', due to the fix in
	`eshell-subcommand-arg-values' described just above

	* esh-mode.el (eshell-mode): set `print-level' also to nil

2000-04-29  John Wiegley  <johnw@gnu.org>

	* esh-cmd.el (eshell-parse-pipeline): moved && and || handling
	here.  This allows them to have a precedence between & ; and > |.
	It means that redirection can be applied separately to any member
	of the chain, but sequencing will still separate the chains.

	* esh-io.el (eshell-strip-redirections): changed a little bit of
	code to be more clear

	* esh-arg.el (eshell-parse-delimiter): both && and & were being
	parsed as the same operator

2000-04-27  John Wiegley  <johnw@gnu.org>

	* esh-util.el (eshell-number-regexp): 0 by itself counts as a
	number

	* esh-cmd.el (eshell-parse-pipeline): fixed some problems with
	"if" and output redirection, and also implemented "&&" and "||".
	This last feature is a convenience only, and doesn't play well
	with piping and subjobs.  You can use it to predicate a command on
	the result of a previous command:

	  file-exists-p FILE && echo it exists!

	* em-unix.el: added three new variables:
	eshell-mv-overwrite-files, eshell-cp-overwrite-files and
	eshell-ln-overwrite-files, in order to change the default
	behavior.  The default is yes to all three.  If they are set to
	nil, then overwriting a file requires the "-f" option.
	(eshell-grep): don't show the files matched by the
	global pattern when grep'ing.  It only clutters the display.
	(eshell-time-start): bold the result of the `time' command
	(eshell/ln): ln -sf was not being forceful
	(eshell/rm): rm NUMBER wasn't working

	* eshell.el (eshell-report-bug): instead of using
	`rfc822-goto-eoh', I just inlined the code, since not all XEmacs
	versions had this function.  Also, the output from `emacs-version'
	is now inserted into the bug message

	* esh-var.el (eshell-var-initialize): changed C-c e to C-c M-v

	* esh-util.el (eshell-redisplay): ignore errors in `sit-for'.
	This happens on Emacs 21 quite a bit in certain situations
	(eshell-directory-files-and-attributes): use `expand-file-name'.
	This clears up some bizarre errors with "ls" that were biting
	XEmacs 21.2 users

	* esh-proc.el (eshell-proc-initialize): changed C-c p to C-c M-i
	(eshell-gather-process-output): on non-Mule emacsen, don't mess
	with the process-coding-system

	* esh-mode.el (eshell-mode): changed C-c h to C-c M-o
	(eshell-mode): always make `print-length' locally be nil

	* esh-io.el (eshell-set-output-handle): if `null-device' is not
	bound, try `grep-null-device', otherwise only accept "/dev/null"

	* esh-arg.el (eshell-arg-initialize): changed C-c b to C-c M-b
	(eshell-parse-delimiter): added parsing support for "&&" and "||"
	as operators

	* em-rebind.el (eshell-cannot-leave-input-list): added
	`kill-region'.  This only occurs on Emacs 21, when C-x DEL is
	used, for example.
	(eshell-rebind-initialize): changed C-c l to C-c M-l
	(eshell-rebind-input-map): if `kill-region' is the command
	attempting to leave the current input area, don't double-beep

	* em-pred.el (eshell-pred-initialize): changed C-c ? to C-c M-q,
	and C-c m to C-c M-m

	* em-ls.el (eshell-ls-directory-face): use the color name "Dark
	Cyan" instead of "DarkCyan".  At least one Dec user reported this
	difference as being necessary.

	* em-hist.el (eshell-isearch-backward): inhibit-read-only, and fix
	the value of eshell-last-output-end.  This problem was specific to
	Emacs 21.

	* em-glob.el (eshell-glob-entries): fixed a bug that caused
	escaping properties to be stripped from globs, making # impossible
	to search for, for example

	* em-dirs.el (eshell/cd): added support for a ksh feature: cd old
	new.  This will replace old with new in the current directory name
	(as it appears in the prompt, or from pwd)

	* em-cmpl.el (eshell-default-completion-function): use
	`pcomplete-dirs-or-entries' instead of just `pcomplete-entries'.
	Otherwise, the commands listed in
	`eshell-command-completions-alist' will never get a chance to look
	for their files in other directories
	(eshell-cmpl-initialize): Changed C-c i binding to C-c M-h

2000-03-27  John Wiegley  <johnw@gnu.org>

	* em-rebind.el (eshell-lock-local-map): Added a call to
	`use-local-map', since sometimes Eshell gets a bit confused and
	does not properly restore the input keymap.  This happens
	especially around Lisp errors during input.
	(eshell-rebind-input-map): Traps any errors that occur;
	otherwise, this function will get taken off of
	`post-command-hook'.

2000-03-23  John Wiegley  <johnw@gnu.org>

	* em-unix.el (eshell-remove-entries): Fixed a fairly serious
	problem when attempting to remove a symlink to a directory, or
	when moving or copying recursively, and a symlink is encountered.

2000-03-19  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.2.1

	* em-hist.el (eshell-return-to-prompt): Added a missing variable
	binding.

	* esh-proc.el (eshell-gather-process-output): Added two missing
	variable bindings.

2000-03-16  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.2

	* em-hist.el (eshell-previous-matching-input-string-position):
	make history lookup on non-Windows systems case-sensitive.

	* em-glob.el (eshell-glob-entries): fixed an incorrect use of
	directory-file-name that was stripping text properties off of glob
	patterns.

	* esh-proc.el (eshell-gather-process-output): fixed a
	process-coding-system setting that was causing scp output to be
	handled incorrectly.  The correction code comes from comint.el.
	(eshell-sentinel): removed a useless error that incorrectly made
	people think that bad things were going on.

2000-03-08  John Wiegley  <johnw@gnu.org>

	* em-hist.el (eshell-isearch-backward): added incremental
	searching through the history, similar to bash.  Just use C-r and
	C-s.  Repeat to continue the search.

	* em-cmpl.el (eshell-complete-commands-list): if no
	external-commands match the specified initial commands, permits
	lisp completions.

2000-03-07  John Wiegley  <johnw@gnu.org>

	* esh-util.el (eshell-convert): the result of a command
	interpolations should always be a list, even if it's only one
	element long.

	* em-ls.el (eshell-do-ls): removed `eshell-ls-initial-args'.
	People should use aliases for that sort of thing.

2000-03-06  John Wiegley  <johnw@gnu.org>

	* em-unix.el: improved recursive cp and mv, and removed all
	dependence on the em-glob extension module.

	* esh-util.el: removed definition of `match-string-no-properties'.

	* esh-io.el (eshell-parse-redirection): don't use
	`match-string-no-properties'.  The version defined in esh-util.el
	doesn't work with XEmacs 21.2.  It wasn't strictly necessary
	anyway.

	* esh-arg.el (eshell-parse-argument-hook): don't use
	`match-string-no-properties'.

	* esh-var.el (eshell-parse-variable-ref): don't use
	`match-string-no-properties'.

2000-03-05  John Wiegley  <johnw@gnu.org>

	* em-unix.el (eshell/time): implemented a simple version of `time'
	in Lisp.  It only displays elapsed wall-clock time, since Emacs
	doesn't provide a facility for determining the user/kernel time
	actually consumed during the execution of a subprocess.

2000-03-04  John Wiegley  <johnw@gnu.org>

	* em-pred.el (eshell-pred-file-time): extended file-time test
	predicate so an epoch file can be specified: "*(m-'file.c')"
	results in all files modified more recently than "file.c".

	* em-ls.el (eshell-do-ls): added support for -I regexp, to exclude
	certain files from being listed.

	* esh-opt.el (eshell-set-option): fixed error in elimination of
	arguments passed as switch parameters.

	* esh-cmd.el (eshell-do-eval): added support for: while, until, if
	and unless.

2000-03-03  John Wiegley  <johnw@gnu.org>

	* em-unix.el (eshell/make): invoke compilation-mode only if make
	is being background, *and* not redirected.

	* esh-util.el (eshell-read-host-names): moved the /etc/hosts
	reading code here from em-xtra, so that it lives nearby the
	/etc/passwd and /etc/group reading code.

	* esh-cmd.el (eshell-find-alias-function): fixed a problem with
	the regexp.

	* em-xtra.el: moved a lot of code out of this module into em-unix,
	since it really belonged there.  It's not experimental anymore.

	* em-unix.el (eshell-unix-plain-grep-behavior): moved the `grep'
	and `make' aliases from em-xtra into this module.  New
	configuration variable `eshell-unix-plain-grep-behavior' controls
	whether fanciness should happen when a plain grep is invoked.
	(pcomplete/rsh): moved completion code for hostnames from em-xtra
	into em-unix.

	* em-basic.el (eshell/printnl): moved this function to the `basic'
	extension module.  Split up the functionality of `echo' a bit.

2000-03-02  John Wiegley  <johnw@gnu.org>

	* eshell.el: All of the optional extension modules are now named
	"em-NAME.el".  The required modules are named "esh-NAME.el".  This
	was done to avoid name collisions on filesystems with 8.3 filename
	restrictions.

	The internal (i.e., Lisp) names of the modules remain the same; so
	that "em-alias.el" defines the feature `em-alias', but the group
	`eshell-alias', along with its member functions and variables, all
	names beginning with "eshell-alias-".

	* eshell-unix.el (eshell/cat): if eshell/cat is part of a
	pipeline, use the external version instead.

	* eshell.el: removed documentation which is not relevant, now that
	Eshell is part of Emacs.

	* eshell-maint.el (eshell-make-readme): removed creation of
	eshell.html, since it's no longer relevant.

2000-03-01  John Wiegley  <johnw@gnu.org>

	* eshell-unix.el (eshell/cat): if invoked as part of a pipeline,
	call system cat.  The Lisp cat doesn't know how to read from
	standard input.

	* eshell-xtra.el (eshell-grep): improved support for grep.  If
	it's not to the right of a pipe, and if it's output is not
	redirected, Emacs' grep function will be used, allowing the user
	to C-x ` to jump to each hit location.  And now all of the grep
	family is supported.

	* eshell-cmd.el (eshell-execute-pipeline): added variable
	`eshell-in-pipeline-p', which alias functions can use to test
	whether they're executing as part of a pipeline or not.
	(eshell-parse-command): made command parsing code sensitive to
	`eshell-in-pipeline-p' so that it does the right thing, without
	the author of the alias function having to care.  For example,
	`eshell-trap-errors' is not supposed to be wrapped around pipe
	segment parts, and named commands should call
	`eshell-named-command*' instead of `eshell-named-command'.

	* eshell-io.el (eshell-set-output-handle): allow the value of
	`null-device' to be a dummy output target; equivalent to
	"/dev/null" (and on UNIX, identical).

	* eshell-xtra.el (eshell/make): the current process-environment
	wasn't being passed, meaning the compile buffer didn't always
	share the same PATH as the parent Eshell buffer, for example.

2000-02-29  John Wiegley  <johnw@gnu.org>

	* eshell-pred.el (eshell-modifier-alist): New list argument
	modifier: `u', which uniq's the list.  To sort and uniq, use
	(:o:u).

	* eshell-util.el (eshell-uniqify-list): New function.

	* eshell-unix.el (eshell/man): Fixed eshell/man so that it passes
	the arguments correctly in the case of "man 5 rsyncd.conf".

	* eshell-script.el (eshell/.): Added a usage message.
	(eshell/source): Added a usage message.

	* TODO: Updated the list.  Some of the items have since been fixed
	or implemented.

	* eshell-glob.el (eshell-glob-translate-alist): Added new globbing
	characters #?, #* and #+, which mean (in regular expression terms)
	?, * and +.  So that ## #+ # #* #?  mean + + * * ?, respectively.

	* eshell-mode.el (eshell-send-input): If a multi-line command is
	entered, and the cursor is moved to the beginning of the command,
	and RET is pressed: move point to the end of the buffer, rather
	than just the end of the line (which was truncating the command).

	* eshell-xtra.el (eshell/printnl): Added `printnl' command.  This
	is so I can do things like:

	  comm -23 $<cd ~/src; printnl **/*.c(:o)> \
		   $<cd /usr/src; printl **/*.c(:o)>

	to see the differences in C file content between "~/src" and
	"/usr/src".

	* eshell-cmd.el (eshell-do-eval): `function' is another kind of
	`quote', so treat it as such.
	(eshell-trap-errors): Added local `eshell-this-command-hook'
	variable, to allow execution of a piece of code immediately after
	a command (a pipe segment) is done.

	* eshell-var.el (eshell-parse-variable-ref): Made $'alpha' and
	$"alpha" the new syntax for quoting variable names.  This was
	because $<command> now captures the output of COMMAND in a temp
	file, whose name it then passes as the result of the interpolation
	-- deleting the temporary file after the governing command has
	completed.  I.e., "wc -l $<echo alpha>" returns 1 for the temp
	file, and then deletes the temp file after the "wc" process has
	completed.

2000-02-23  John Wiegley  <johnw@gnu.org>

	* eshell-pred.el: Added quick-help documentation for all of the
	default argument predicates and modifiers, since I'm eternally
	forgetting them.  Use C-c ? in an Eshell buffer to see help on the
	allowed predicates, and C-c m to see help on the modifiers.  This
	help text will not include any user-defined predicates.

2000-02-22  John Wiegley  <johnw@gnu.org>

	* eshell-proc.el (eshell-delete-exited-processes): Fixed two
	documentation bugs.

2000-02-21  John Wiegley  <johnw@gnu.org>

	* eshell-pred.el (eshell-pred-file-type): Was missing a call to
	`directory-file-name', which caused 'ls -d *(^@)' not to work
	whenever a directory contained symbolic links to directories.
	Calling `file-attributes' on 'Mail' returns the attributes of the
	symbolic link, whereas calling it on 'Mail/' returns the
	attributes of the directory it points to.

2000-02-16  John Wiegley  <johnw@gnu.org>

	* eshell-ls.el (eshell-ls-files): Corrected several problems with
	display of symbolic links, -L and correct font selection.

2000-02-15  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.1.6.

	* eshell-ls.el (eshell-ls-backup-regexp): Added #* and .#* files
	to the backup-regexp.
	(eshell-ls-clutter-regexp): Removed .bak from the clutter regexp.

	* eshell-alias.el (eshell-maybe-replace-by-alias): Don't allow
	further alias expansion of any alias names currently being
	expanded.
	(eshell-fix-bad-commands): Fixed a bug with bad command fixing,
	when arguments were involved.

2000-02-15  Alex Schroeder <asc@bsiag.com>

	* eshell-unix.el (eshell-shuffle-files): Added interactive support
	to mv, cp and ln.  Relevant customization variables were also
	created.

2000-02-10  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.1.5.

	* eshell-unix.el (eshell/rm): Fixed a problem that was preventing
	buffers from being deleted.

	* eshell-opt.el (eshell-eval-using-options): If :preserve-args is
	set in an option list, do not flatten and convert the arguments to
	strings.  The function called is responsible for any such
	conversions.

	* eshell-basic.el (eshell/echo): Preserve the original form of any
	arguments to `echo'.

2000-02-10  Alex Schroeder <asc@bsiag.com>

	* eshell-unix.el (eshell/rm): Added support for interactive
	querying when removing files.

2000-02-08  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.1.4.

	* eshell-unix.el (eshell-shuffle-files): Don't test files for
	equivalence on Windows.  Since Windows doesn't support hard
	linking, it doesn't mean anything anyway.

	* eshell-mode.el: Don't run `shows no command running' test on
	XEmacs.  This benign test doesn't seem to run on XEmacs.

	* eshell-glob.el (eshell-add-glob-modifier): Repaired a broken
	modifier in the case that glob fails to match anything.

	* eshell.el: Documentation correction.

	* INSTALL: Added some missing steps concerning `load-path'.

2000-02-08  Sudish Joseph  <sj@eng.mindspring.net>

	* eshell-cmd.el (eshell-lookup-function): New function, from
	edebug.
	(eshell-functionp): New function, from edebug.
	(eshell-macrop): Now works with XEmacs 21.2.

	* eshell-mode.el (eshell-mode-syntax-table): Handle XEmacs
	separately since the character representation there differs.

2000-02-03  John Wiegley  <johnw@gnu.org>

	* eshell.el: Released version 2.1.3.

	* eshell.el (eshell-command-result): fixed a bug that was causing
	`M-x eshell' immediately after `M-x eshell-command' to generate an
	error.  added documentation stating what the problems are with
	running certain Eshell on certain versions of Emacs.

	* eshell-xtra.el (pcomplete/bcc): fixed some missing '*'
	characters, which were affecting the documentation generator.

	* eshell-var.el (eshell-parse-indices): use `nreverse'.

	* eshell-util.el (eshell-convert): fixed line splitting.  It is
	now possible to say "length ${egrep blah FILE}" to count how many
	lines in FILE contain "blah".  There are more useful uses of this;
	basically if a subcommand returns multiple lines, it will now be
	converted into a list of arguments.  For example, "for i in ${ls
	-1 /tmp}" is now the same as "for i in /tmp/*".

	* eshell-unix.el: fixed several behavioral problems with cp, mv
	and ln.

	* eshell-rebind.el (eshell-delchar-or-maybe-eof): fixed a bug
	where C-d was exiting Eshell, even if there was text beyond point.

	* eshell-proc.el (eshell-process-interact): added code (that is
	disabled by default) for automatically killing processes when an
	Eshell buffer is exited.  Only the processes spawned by that
	Eshell session are killed.  If the process fails to die, further
	signals are sent to it, increasing in severity.  Customize the
	group `eshell-proc' to see more.

	* eshell-pred.el: fixed several robustness issues in cases where
	the argument being predicated resulted in a non-string value.
	(eshell-modifier-alist): use `nreverse'.

	* eshell-opt.el (eshell-process-args): fixed a bug that prevented
	"--" from working in the case of Lisp functions (like "ls").

	* eshell-mode.el: added `eshell-first-time-mode-hook', to allow
	overriding of function definitions loaded from Eshell modules.
	added `eshell-exit-hook', which is run when an Eshell buffer is
	killed.
	(eshell-mode): removed funding message.

	* eshell-maint.el (eshell-opt): added font-lock commands that I
	use for highlighting Eshell source.  The user is not affected by
	these.

	* eshell-ls.el (eshell-ls-missing-face): add .bz2 to the archive
	regexp.
	(eshell-ls-file): use `file-truename' on the referral directory
	when checking the validity of symlinks.
	(eshell-ls-sort-entries): use `nreverse'.
	(eshell-ls-files): moved code that checks for invalid ls
	arguments, since before it was messing up the display.
	And use `nreverse'.  It saves memory.

	* eshell-io.el (eshell-always-to-pipe): removed this variable.
	(eshell-strip-redirections): fixed a bug that was leaving
	redirection target names in the command's argument list when there
	were multiple targets.

	* eshell-hist.el (eshell-hist-initialize): add history writing
	function to `eshell-exit-hook' instead of `buffer-kill-hook'.
	(eshell-save-some-history): if this variable is nil, don't ask if
	the user wants to save history.
	(eshell-expand-history-references): use `nreverse'.

	* eshell-glob.el (eshell-glob-entries): use `nreverse'.  also,
	fixed a bug that was causing `**/dir' not to find directories.

	* eshell-ext.el (eshell/addpath): use `nreverse'.

	* eshell-dirs.el: OLDPWD wasn't being set due to a type.  Moved
	code for saving last-dir-ring from `buffer-kill-hook' to
	`eshell-exit-hook'.  Moved `eshell-rewrite-for-command' to
	eshell-cmd.el, where it should have been all along.
	(eshell/pushd): use `nreverse'.

	* eshell-cmd.el: moved `eshell-rewrite-for-command' into this
	file, and added the global `eshell-ensure-newline-p', which Lisp
	functions may set to nil to prevent newlines from appearing after
	Lisp results.  echo -n uses this.

	* eshell-basic.el: changed `echo' to accept -n switch.

	* eshell-toggle.el: added new commands `eshell-toggle' and
	`eshell-toggle-cd', for toggling to and from the Eshell buffer.
	Very handy.  Thanks to Mikael Sjödin for this code.

	* Makefile (install_elc): install eshell-auto.el with the compiled
	lisp files.

1999-12-10  John Wiegley  <johnw@gnu.org>

	* eshell.el (eshell-version): Released version 2.1.2.

	* eshell-smart.el (eshell-refresh-windows): only refresh the
	display if an Eshell buffer was visible

1999-12-06  John Wiegley  <johnw@gnu.org>

	* eshell-rebind.el (eshell-delchar-or-maybe-eof): error in logic
	which was causing C-d at end of buffer to cause a Lisp error in
	some circumstances

	* eshell-prompt.el (eshell-prompt-regexp): documented the fact
	that changing this variable requires restarting Eshell

	* eshell.el: added documentation listing the supported versions of
	Emacs and XEmacs.
	(test/eshell-directory-modes): since Windows doesn't have real
	file permissions, skip this test on those systems

	* eshell-mode.el (eshell-first-message): added a note that the
	fundraising message can be viewed again using the command
	"eshell-fund".
	(eshell-first-startup-message): made this function runnable from
	the Eshell command line.
	(eshell/eshell-fund): added an alias so that users could re-view
	the fundraising message easily.
	(test/send-to-subprocess): on systems which don't have "bc" (such
	as Windows), just skip this test.

	* eshell-hist.el, eshell-cmpl.el: glob expansion was documented as
	<C-SPC>, but it's really <C-c SPC>.
